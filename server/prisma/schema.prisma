// Prisma Schema for RealWorks App
// PostgreSQL Database

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER & AUTHENTICATION
// ============================================

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  name          String
  avatar        String?
  phone         String?
  isVerified    Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastLoginAt   DateTime?

  // Relations
  settings      UserSettings?
  transactions  Transaction[]
  savingsGoals  SavingsGoal[]
  budgets       Budget[]
  healthData    HealthData?
  moodLogs      MoodLog[]
  journalEntries JournalEntry[]
  chatMessages  ChatMessage[]
  refreshTokens RefreshToken[]

  @@map("users")
}

model UserSettings {
  id                String   @id @default(uuid())
  userId            String   @unique
  darkMode          Boolean  @default(false)
  notifications     Boolean  @default(true)
  biometricAuth     Boolean  @default(false)
  currency          String   @default("USD")
  language          String   @default("en")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_settings")
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  isRevoked Boolean  @default(false)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

// ============================================
// FINANCIAL DATA
// ============================================

model Transaction {
  id          String   @id @default(uuid())
  userId      String
  title       String
  amount      Float
  type        TransactionType
  category    String
  icon        String?
  color       String?
  date        DateTime @default(now())
  isRecurring Boolean  @default(false)
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@index([userId, type])
  @@index([userId, category])
  @@map("transactions")
}

enum TransactionType {
  income
  expense
}

model SavingsGoal {
  id        String   @id @default(uuid())
  userId    String
  name      String
  current   Float    @default(0)
  target    Float
  color     String?
  icon      String?
  deadline  DateTime?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("savings_goals")
}

model Budget {
  id        String   @id @default(uuid())
  userId    String
  name      String
  category  String
  limit     Float
  spent     Float    @default(0)
  period    BudgetPeriod @default(monthly)
  color     String?
  icon      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("budgets")
}

enum BudgetPeriod {
  weekly
  monthly
  yearly
}

// ============================================
// HEALTH & WELLNESS DATA
// ============================================

model HealthData {
  id             String   @id @default(uuid())
  userId         String   @unique
  cycleDay       Int?
  lastPeriodDate DateTime?
  cycleLength    Int?     @default(28)
  vitalityScore  Int?
  sleepQuality   Int?
  exerciseFreq   Int?
  stressLevel    Int?
  nutritionScore Int?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("health_data")
}

model MoodLog {
  id        String   @id @default(uuid())
  userId    String
  level     Int      // 1-5
  note      String?
  factors   String[] // Array of factors affecting mood
  date      DateTime @default(now())
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@map("mood_logs")
}

model JournalEntry {
  id        String   @id @default(uuid())
  userId    String
  content   String
  mood      String?
  tags      String[]
  date      DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@map("journal_entries")
}

// ============================================
// CHAT & AI INTERACTION
// ============================================

model ChatMessage {
  id        String   @id @default(uuid())
  userId    String
  role      ChatRole
  content   String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@map("chat_messages")
}

enum ChatRole {
  user
  model
}
